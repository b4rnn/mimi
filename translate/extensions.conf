[zadarma-in]
exten => _XXX.,1,Dial(SIP/${EXTEN})
exten => _XXX.,n,Answer()
exten => _XXX.,n,Hangup()

;BEGIN SESSION FOR CALLER @SIP---desktop
exten =>254208789522,1,NoOp(First Line)
same =>n,Set(FILE=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILE}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILE}')
same =>n,NoOp(${SYSTEMSTATUS})
;same =>n,GotoIf($[${SYSTEMSTATUS}=SUCCESS] ? 1 : 2); Goto(1111,2)
same =>n,Playback(${FILE})
;SESSION ONE
same =>n,Goto(SESSION-ONE)
same =>n(SESSION-ONE),Set(FILEONE=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEONE}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEONE}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEONE})
;SESSION TWO
same =>n,Goto(SESSION-TWO)
same =>n(SESSION-TWO),Set(FILETWO=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILETWO}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILETWO}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILETWO})
;SESSION THREE
same =>n,Goto(SESSION-THREE)
same =>n(SESSION-THREE),Set(FILETHREE=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILETHREE}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILETHREE}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILETHREE})
;SESSION FOUR
same =>n,Goto(SESSION-FOUR)
same =>n(SESSION-FOUR),Set(FILEFOUR=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEFOUR}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEFOUR}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEFOUR})
;SESSION FIVE
same =>n,Goto(SESSION-FIVE)
same =>n(SESSION-FIVE),Set(FILEFIVE=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEFIVE}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEFIVE}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEFIVE})
;SESSION SIX
same =>n,Goto(SESSION-SIX)
same =>n(SESSION-SIX),Set(FILESIX=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILESIX}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILESIX}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILESIX})
;SESSION SEVEN
same =>n,Goto(SESSION-SEVEN)
same =>n(SESSION-SEVEN),Set(FILESEVEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILESEVEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILESEVEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILESEVEN})
;SESSION EIGHT
same =>n,Goto(SESSION-EIGHT)
same =>n(SESSION-EIGHT),Set(FILEEIGHT=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEEIGHT}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEEIGHT}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEEIGHT})
;SESSION NINE
same =>n,Goto(SESSION-NINE)
same =>n(SESSION-NINE),Set(FILENINE=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILENINE}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILENINE}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILENINE})
;SESSION TEN
same =>n,Goto(SESSION-TEN)
same =>n(SESSION-TEN),Set(FILETEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILETEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILETEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILETEN})
;SESSION ELEVEN
same =>n,Goto(SESSION-ELEVEN)
same =>n(SESSION-ELEVEN),Set(FILEELEVEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEELEVEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEELEVEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEELEVEN})
;SESSION TWELVE
same =>n,Goto(SESSION-TWELVE)
same =>n(SESSION-TWELVE),Set(FILETWELVE=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILETWELVE}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILETWELVE}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILETWELVE})
;SESSION THIRTEEN
same =>n,Goto(SESSION-THIRTEEN)
same =>n(SESSION-THIRTEEN),Set(FILETHIRTEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILETHIRTEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILETHIRTEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILETHIRTEEN})
;SESSION FOURTEEN
same =>n,Goto(SESSION-FOURTEEN)
same =>n(SESSION-FOURTEEN),Set(FILEFOURTEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEFOURTEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEFOURTEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEFOURTEEN})
;SESSION FIFTHTEEN
same =>n,Goto(SESSION-FIFTHTEEN)
same =>n(SESSION-FIFTHTEEN),Set(FILEFIFTHTEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEFIFTHTEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEFIFTHTEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEFIFTHTEEN})
;SESSION SIXTEEN
same =>n,Goto(SESSION-SIXTEEN)
same =>n(SESSION-SIXTEEN),Set(FILESIXTEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILESIXTEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILESIXTEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILESIXTEEN})
;SESSION SEVENTEEN
same =>n,Goto(SESSION-SEVENTEEN)
same =>n(SESSION-SEVENTEEN),Set(FILESEVENTEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILESEVENTEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILESEVENTEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILESEVENTEEN})
;SESSION EIGHTTEEN
same =>n,Goto(SESSION-EIGHTTEEN)
same =>n(SESSION-EIGHTTEEN),Set(FILEEIGHTTEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILEEIGHTTEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILEEIGHTTEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILEEIGHTTEEN})
;SESSION NINETEEN
same =>n,Goto(SESSION-NINETEEN)
same =>n(SESSION-NINETEEN),Set(FILENINETEEN=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILENINETEEN}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILENINETEEN}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILENINETEEN})
;SESSION TWENTY
same =>n,Goto(SESSION-TWENTY)
same =>n(SESSION-TWENTY),Set(FILETWENTY=${CALLERID(num)}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
same =>n,Record(${FILETWENTY}:wav,3,3,q)
same =>n,System(/opt/test/call.sh omoshmoze@gmail.com '${CDR(src)}' '${CALLERID(name)}' '${FILETWENTY}')
same =>n,NoOp(${SYSTEMSTATUS})
same =>n,Playback(${FILETWENTY})
;SESSION ENDED ..says good-bye then hangs up caller @sip
same =>n,Playback(say-bye-bye)
same =>n,Hangup()

[message]
exten => 254208789522,1,NoOp(blah!)
exten => s,n,NoOp(${MESSAGE(from)})
exten => s,n,NoOp(${MESSAGE(to)})
exten => s,n,NoOp(${MESSAGE(body)})
exten => s,n,NoOp(${SIPFROMUSER})
exten => s,n,Set(SRC=${MESSAGE(from)})
exten => s,n,Set(DST=${MESSAGE(to)})
exten => s,n,Set(MSG=${MESSAGE(body)})
;exten => s,n,System(/opt/test/chat.sh  -SRC '${SRC}' -DST '${DST}' -MSG '${MSG}')
exten => s,n,System(/opt/test/chat.sh   '${SRC}' '${DST}' '${MSG}')
;exten => s,n,MessageSend(${MESSAGE(to)},${SIPFROMUSER})

[websms]
exten => _X.,1,NoOp(SMS receiving dialplan invoked)
exten => _X.,n,NoOp(To ${MESSAGE(to)})
exten => _X.,n,NoOp(From ${MESSAGE(from)})
exten => _X.,n,NoOp(Body ${MESSAGE(body)})
exten => _X.,n,Set(ACTUALTO=${CUT(MESSAGE(to),@,1)})
exten => _X.,n,ExecIf($["${ACTUALTO}" != "sip:${EXTEN}"]?Set(ACTUALTO=sip:${EXTEN}))
exten => _X.,n,MessageSend(${ACTUALTO},${MESSAGE(from)})
exten => _X.,n,NoOp(Send status is ${MESSAGE_SEND_STATUS})
exten => _X.,n,GotoIf($["${MESSAGE_SEND_STATUS}" != "SUCCESS"]?sendfailedmsg)
exten => _X.,n,Hangup()

[from-internal]
exten = 100,1,Answer()
same = n,Wait(1)
same = n,Playback(hello-world)
same = n,Hangup()

[zadarma-in-01]
;incoming calls are routed on extension number 101
exten => 254208789522,1, Dial(SIP/101)
same =>n,NoOp(${EXTEN})
[zadarma-out]
exten => _XXX,1,Dial(SIP/${EXTEN})                                      ;calls on 3-digit numbers of Asterisk
exten => _XXX.,1,Set(CALLERID(num)=254208789522)         ;CallerID setup 254208789522
same => n,Dial(SIP/zadarma/${EXTEN})

[phones]
exten => 1001,1,Answer()
 same => n,Set(START=${CALLERID(num):1}--${EXTEN}--${STRFTIME(${EPOCH},,%d-%m-%Y--%H-%M-%S)})
 same => n,Playback(hello-world)
 same =>n,NoOp(${SYSTEMSTATUS})
 same => n,Wait(1)
 same => n,Record(${START}.wav)
 same =>n,NoOp(${SYSTEMSTATUS})
 same => n,Wait(1)
 same => n,Hangup()

